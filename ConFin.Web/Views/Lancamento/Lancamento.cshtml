@using ConFin.Common.Web.Extension
@model IEnumerable<ConFin.Web.ViewModel.LancamentoViewModel>
@{ Layout = null;}

<style>
    .indicador-green {
        background-color: green !important;
    }
</style>

<div class="container">
    <div class="section" style="text-align: center">
        <h1 style="color: gray; font-size: 20pt;" class="caption">Lançamentos</h1>
        <div class="divider"></div>
    </div>

    <table class="striped">
        <thead>
            <tr>
                <th></th>
                <th>Data</th>
                <th>Descrição</th>
                <th>Valor</th>
                <th>Conta</th>
                <th>Categoria</th>
                <th>Pago</th>
                <th></th>
            </tr>
        </thead>

        <tbody>
            @if (Model != null && Model.Any())
            {
                foreach (var lancamento in Model)
                {
                    <tr>
                        <td>
                            @if (lancamento.IsReceita)
                            {
                                <a style="color: #008000" class="tooltipped" data-position="top" data-delay="25" data-tooltip="Receita">
                                    <i class="material-icons">tag_faces</i>
                                </a>
                            }
                            else
                            {
                                <a style="color: #ff0000" class="tooltipped" data-position="top" data-delay="25" data-tooltip="Despesa">
                                    <i class="material-icons">mood_bad</i>
                                </a>

                            }
                        </td>
                        <td>@lancamento.DataLancamento</td>
                        <td>@lancamento.Descricao</td>
                        <td>@lancamento.ValorLancamento</td>
                        <td>@lancamento.NomeConta</td>
                        <td class="center-align">
                            <a style="cursor: default" class="tooltipped" data-position="top" data-delay="25" data-tooltip="@lancamento.NomeCategoria">
                                <i style="color: @lancamento.CorCategoria" class="material-icons">bookmark</i>
                            </a>
                        </td>
                        <td>
                            @if (lancamento.IsPago)
                            {
                                <a href="javascript:void(0)" class="btn-floating indicador-green tooltipped" data-position="top" data-delay="25" data-tooltip="@(lancamento.IsReceita ? "Recebido" : "Pago")">
                                    <i class="material-icons">thumb_up</i>
                                </a>
                            }
                            else if (lancamento.IsVencido)
                            {
                                <a href="javascript:void(0)" class="btn-floating tooltipped" style="background-color: #ff0000!important" data-position="top" data-delay="25" data-tooltip="Atrasado">
                                    <i class="material-icons">thumb_down</i>
                                </a>
                            }
                            else
                            {
                                <a href="javascript:void(0)" style="background-color: gray" class="btn-floating tooltipped" data-position="top" data-delay="25" data-tooltip="Não @(lancamento.IsReceita ? "Recebido" : "Pago")">
                                    <i class="material-icons">thumb_up</i>
                                </a>
                            }
                        </td>
                        <td class="center-align">
                            <a style="color: crimson" href="javascript:void(0)" onclick="deleteLancamento(@lancamento.Id)"
                               class="tooltipped" data-position="top" data-delay="25" data-tooltip="Excluir">
                                <i class="material-icons">delete_forever</i>
                            </a>
                            <a style="color: dimgray" href="javascript:void(0)" onclick="showModalCadastroEdicaoLancamento(@lancamento.Id)"
                               class="tooltipped" data-position="top" data-delay="25" data-tooltip="Editar">
                                <i class="material-icons">mode_edit</i>
                            </a>
                        </td>
                    </tr>
                }
            }
            else
            {
                <tr><td style="text-align: center" colspan="8">Nenhum registro encontrado.</td></tr>
            }

        </tbody>
    </table>
</div>

<div class="fixed-action-btn">
    <a class="btn-floating btn-large">
        <i class="large material-icons">add</i>
    </a>
    <ul>
        <li>
            <a href="javascript:void(0)" onclick="showModalCadastroEdicaoLancamento(null, 'R')"
               class="btn-floating green modal-trigger tooltipped" data-position="left" data-delay="25" data-tooltip="Receita">
                <i class="material-icons">tag_faces</i>
            </a>
        </li>
        <li>
            <a href="javascript:void(0)" onclick="showModalCadastroEdicaoLancamento(null, 'D')"
               class="btn-floating red modal-trigger tooltipped" data-position="left" data-delay="25" data-tooltip="Despesa">
                <i class="material-icons">mood_bad</i>
            </a>
        </li>
    </ul>
</div>

<script>

    $('.tooltipped').tooltip({ delay: 25 });

    var urlsLancamento = {
        Lancamento: '@Url.Action("Lancamento", "Lancamento")',
        GetModalCadastroEdicao: '@Url.Action("GetModalCadastroEdicao", "Lancamento")',
        Post: '@Url.Action("Post", "Lancamento")',
        Put: '@Url.Action("Put", "Lancamento")',
        Delete: '@Url.Action("Delete", "Lancamento")'
    };

    function showModalCadastroEdicaoLancamento(idLancamento, indicadorReceitaDespesa) {
        $.get(urlsLancamento.GetModalCadastroEdicao, {
            idLancamento: idLancamento,
            indicadorReceitaDespesa: indicadorReceitaDespesa
        }).success(function (data) {
            $("#containerPrincipal").append(data);
            $('#modalLancamentoCadastroEdicao').modal({
                complete: function () {
                    $('#modalLancamentoCadastroEdicao').remove();
                }
            });
            $("#modalLancamentoCadastroEdicao").modal("open");
            verifyLabelActive();
        });
    }

    function deleteLancamento(idLancamento) {
        showModalConfirm("Deseja realmente excluir este lançamento?", function () {
            $.post(urlsLancamento.Delete, {
                idLancamento: idLancamento
            }).success(function (data) {
                showToast(data, "green");
                atualizarLancamentos();
            });
        });
    }

    function atualizarLancamentos() {
        setTimeout(function () {
            $.get(urlsLancamento.Lancamento).success(function (data) {
                $("#containerPrincipal").html(data);
            });
        }, 100);

    }

</script>
